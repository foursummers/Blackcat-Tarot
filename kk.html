<!-- ... (保留你之前的所有代码) ... -->

    <!-- 微信/QQ 引导遮罩 (新加的部分) -->
    <div id="wx-mask" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:9999; text-align:right; padding-top:20px; padding-right:20px;">
        <div style="color:#fff; font-size:16px; line-height:1.8; margin-right:20px; display:inline-block; text-align:left;">
            <span style="font-size:24px;">↗</span><br>
            <b>微信暂不支持魔法显现</b><br>
            请点击右上角三个点 [...]<br>
            选择 <b>在浏览器打开</b> 即可体验
        </div>
        <!-- 也可以放一张引导图 -->
        <!-- <img src="guide.png" style="width:100px;"> -->
    </div>

    <script>
        // ... (你之前的 JavaScript 代码) ...

        // --- 新增：微信环境检测 ---
        function isWeChatOrQQ() {
            var ua = navigator.userAgent.toLowerCase();
            return ua.indexOf('micromessenger') !== -1 || ua.indexOf('qq/') !== -1;
        }

        // 如果在微信或QQ中，显示引导层，并停止加载摄像头
        if (isWeChatOrQQ()) {
            document.getElementById('wx-mask').style.display = 'block';
            // 隐藏加载动画，避免用户以为还在加载
            document.getElementById('loader').style.display = 'none';
        } else {
            // 如果不在微信，正常启动摄像头
            // (把原来 camera.start() 的代码移到这里，或者保持原样，因为遮罩层挡住了也没关系，但为了性能最好暂停)
        }

        // ... (你之前的 camera.start 代码) ...
    </script>
</body>
</html>


